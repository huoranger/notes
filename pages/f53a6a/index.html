<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka | 清风徐来</title>
    <meta name="generator" content="VuePress 1.9.5">
    <noscript><meta http-equiv="refresh" content="0; url=https://www.youngkbt.cn/noscript/"><style>.theme-vdoing-content { display:none }</noscript>
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="后端学习记录">
    <meta name="keywords" content="后端博客,个人技术博客,后端,后端开发,后端框架,后端面试题,技术文档,学习,面试,Spring,SpringBoot,SpringCloud,中间件,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.379d0a3f.css" as="style"><link rel="preload" href="/assets/js/app.342c2b09.js" as="script"><link rel="preload" href="/assets/js/2.30520199.js" as="script"><link rel="preload" href="/assets/js/3.b6a398a6.js" as="script"><link rel="preload" href="/assets/js/23.d0073c19.js" as="script"><link rel="prefetch" href="/assets/js/10.994b5850.js"><link rel="prefetch" href="/assets/js/11.c1659061.js"><link rel="prefetch" href="/assets/js/12.959fe22d.js"><link rel="prefetch" href="/assets/js/13.24a0262d.js"><link rel="prefetch" href="/assets/js/14.bf436452.js"><link rel="prefetch" href="/assets/js/15.2c8697f1.js"><link rel="prefetch" href="/assets/js/16.f7279506.js"><link rel="prefetch" href="/assets/js/17.84715369.js"><link rel="prefetch" href="/assets/js/18.dfb7bd60.js"><link rel="prefetch" href="/assets/js/19.aa4102e6.js"><link rel="prefetch" href="/assets/js/20.3ff19899.js"><link rel="prefetch" href="/assets/js/21.aebf0481.js"><link rel="prefetch" href="/assets/js/22.d02107b3.js"><link rel="prefetch" href="/assets/js/24.ca62c6c8.js"><link rel="prefetch" href="/assets/js/25.3a7af7e4.js"><link rel="prefetch" href="/assets/js/26.cf842bf6.js"><link rel="prefetch" href="/assets/js/27.d6b311ac.js"><link rel="prefetch" href="/assets/js/28.e2825727.js"><link rel="prefetch" href="/assets/js/29.81125c48.js"><link rel="prefetch" href="/assets/js/30.02d12be4.js"><link rel="prefetch" href="/assets/js/31.d5e768cf.js"><link rel="prefetch" href="/assets/js/32.61fe1e37.js"><link rel="prefetch" href="/assets/js/33.41697b98.js"><link rel="prefetch" href="/assets/js/34.422b5161.js"><link rel="prefetch" href="/assets/js/35.1712aa86.js"><link rel="prefetch" href="/assets/js/36.7e13554a.js"><link rel="prefetch" href="/assets/js/4.c3c02f28.js"><link rel="prefetch" href="/assets/js/5.cb2907b0.js"><link rel="prefetch" href="/assets/js/6.ef14ec81.js"><link rel="prefetch" href="/assets/js/7.f44b1772.js"><link rel="prefetch" href="/assets/js/8.bd9a75af.js"><link rel="prefetch" href="/assets/js/9.9c7d3342.js">
    <link rel="stylesheet" href="/assets/css/0.styles.379d0a3f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="清风徐来" class="logo"> <span class="site-name can-hide">清风徐来</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程人生" class="dropdown-title"><a href="/web/" class="link-title">编程人生</a> <span class="title" style="display:none;">编程人生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/967878/" class="nav-link">后端笔记</a></li><li class="dropdown-subitem"><a href="/pages/10650d/" class="nav-link">前端笔记</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/21e73a/" class="nav-link">面试突击</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://acheng.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情杂货
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/pages/6da187/" class="nav-link">我的简历</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/huoranger" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://avatars.githubusercontent.com/u/67517385?v=4"> <div class="blogger-info"><h3>清风徐来</h3> <span>分享欲望需要靠回应来延续，热情也是。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程人生" class="dropdown-title"><a href="/web/" class="link-title">编程人生</a> <span class="title" style="display:none;">编程人生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/967878/" class="nav-link">后端笔记</a></li><li class="dropdown-subitem"><a href="/pages/10650d/" class="nav-link">前端笔记</a></li></ul></li><li class="dropdown-item"><!----> <a href="/pages/21e73a/" class="nav-link">面试突击</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://acheng.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  心情杂货
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><!----> <a href="/pages/6da187/" class="nav-link">我的简历</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/huoranger" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>后端技术</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Kafka</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f53a6a/" aria-current="page" class="active sidebar-link">Kafka</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/f53a6a/#kafka-基础架构理论" class="sidebar-link">Kafka 基础架构理论</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/f53a6a/#什么是-kafka" class="sidebar-link">什么是 Kafka</a></li><li class="sidebar-sub-header level3"><a href="/pages/f53a6a/#基本概念" class="sidebar-link">基本概念</a></li><li class="sidebar-sub-header level3"><a href="/pages/f53a6a/#kafka架构" class="sidebar-link">Kafka架构</a></li><li class="sidebar-sub-header level3"><a href="/pages/f53a6a/#主题与分区" class="sidebar-link">主题与分区</a></li><li class="sidebar-sub-header level3"><a href="/pages/f53a6a/#分区副本" class="sidebar-link">分区副本</a></li><li class="sidebar-sub-header level3"><a href="/pages/f53a6a/#消费者组" class="sidebar-link">消费者组</a></li></ul></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他分类</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page han-la"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06970110><div class="articleInfo" data-v-06970110><ul class="breadcrumbs" data-v-06970110><li data-v-06970110><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06970110></a></li> <li data-v-06970110><a href="/categories/?category=%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF" title="分类" data-v-06970110>后端技术</a></li><li data-v-06970110><a href="/categories/?category=%E4%B8%AD%E9%97%B4%E4%BB%B6" title="分类" data-v-06970110>中间件</a></li><li data-v-06970110><a href="/categories/?category=Kafka" title="分类" data-v-06970110>Kafka</a></li></ul> <div class="info" data-v-06970110><div title="作者" class="author iconfont icon-touxiang" data-v-06970110><a href="https://github.com/huoranger" target="_blank" title="作者" class="beLink" data-v-06970110>huoranger</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06970110><a href="javascript:;" data-v-06970110>2022-11-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Kafka<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="kafka-基础架构理论"><a href="#kafka-基础架构理论" class="header-anchor">#</a> Kafka 基础架构理论</h2> <h3 id="什么是-kafka"><a href="#什么是-kafka" class="header-anchor">#</a> 什么是 Kafka</h3> <p>Kafka 是一个使用 Scala 语言编写的基于 ZooKeeper 的高吞吐量低延迟的分布式发布与订阅消息系统，它可以实时处理大量消息数据以满足各种需求，比如基于 Hadoop 的批处理系统，低延迟的实时系统等。即便使用非常普通的硬件，Kafka 每秒也可以处理数百万条消息、其延迟最低只有几毫秒。
在实际开发中，Kafka 常常作为 Spark Streaming 的实时数据源，Spark Streaming 从 Kafka 中读取实时消息进行处理，保证了数据的可靠性与实时性。二者是实时消息处理系统的重要组成部分。
</p> <h3 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h3> <ul><li><strong>消息（Message）</strong>：Kafka 的数据单元被称为消息。可以把消息看成是数据库里的一行数据或一条记录。为了提高效率，消息可以分组传输，每一组消息就是一个批次，分成批次传输可以减少网络开销。但是批次越大，单位时间内处理的消息就越大，因此要在吞吐量和时间延迟之间做出权衡。</li> <li><strong>服务器节点（Broker）</strong>：Kafka 集群包含一个或多个服务器节点，一个独立的服务器节点被称为 Broker。</li> <li><strong>主题 （Topic）</strong>：每条发布到 Kafka 集群的消息都有一个类别，这个类别被称为主题。在物理上，不同主题的消息分开存储；在逻辑上，一个主题的消息虽然保存于一个或多个 Broker 上，但用户只需指定消息的主题即可生产或消费消息，而不必关心消息存于何处。主题在逻辑上可以被认为是一个队列。每条消息都必须指定它的主题，可以简单理解为必须指明把这条消息放进哪个队列里。</li> <li><strong>分区 （Partition）</strong>：为了使 Kafka 的吞吐率可以水平扩展，物理上把主题分成一个或多个分区。创建主题时可指定分区数量。每个分区对应于一个文件夹，该文件夹下存储该分区的数据和索引文件。</li> <li><strong>生产者（Producer）</strong>：负责发布消息到 Kafka 的 Broker，实际上属于 Broker 的一种客户端。生产者负责选择哪些消息应该分配到哪个主题内的哪个分区。默认生产者会把消息均匀地分布到特定主题的所有分区上，但在某些情况下，生产者会将消息直接写到指定的分区。</li> <li><strong>消费者（Consumer</strong>）：从 Kafka 的 Broker 上读取消息的客户端。读取消息时需要指定读取的主题，通常消费者会订阅一个或多个主题，并按照消息生成的顺序读取它们。</li></ul> <h3 id="kafka架构"><a href="#kafka架构" class="header-anchor">#</a> Kafka架构</h3> <p>在 Kafka 中，客户端和服务器之间的通信是通过一个简单的、高性能的、与语言无关的 TCP 协议完成的。该协议进行了版本控制，并与旧版本保持向后兼容。Kafka不仅提供 Java 客户端，也提供其他多种语言的客户端。</p> <p>一个典型的 Kafka 集群中包含若干生产者（数据可以是 Web 前端产生的页面内容或者服务器日志等）、若干 Broker、若干消费者（可以是 Hadoop 集群、实时监控程序、数据仓库或其他服务）以及一个ZooKeeper集群。ZooKeeper用于管理和协调Broker。当Kafka系统中新增了Broker或者某个Broker故障失效时，ZooKeeper将通知生产者和消费者。生产者和消费者据此开始与其他Broker协调工作。</p> <p>Kafka的集群架构如下图所示。生产者使用Push模式将消息发送到Broker，而消费者使用Pull模式从Broker订阅并消费消息。</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/10385897/1661481212923-44c8d229-898f-40d5-979b-caf513c4c098.png" alt="图片.png"></p> <h3 id="主题与分区"><a href="#主题与分区" class="header-anchor">#</a> 主题与分区</h3> <p>Kafka通过主题对消息进行分类，一个主题可以分为多个分区，且每个分区可以存储于不同的Broker上，也就是说，一个主题可以横跨多个服务器。</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/10385897/1661481245445-aaf15aaf-2cd8-4c38-8113-34f137832ac0.png" alt="图片.png"></p> <p>**对主题进行分区的好处是：**允许主题消息规模超出一台服务器的文件大小上限。因为一个主题可以有多个分区，且可以存储在不同的服务器上，当一个分区的文件大小超出了所在服务器的文件大小上限时，可以动态添加其他分区，因此可以处理无限量的数据。</p> <p>Kafka会为每个主题维护一个<strong>分区日志</strong>，<strong>记录各个分区的消息存放情况</strong>。消息以追加的方式写入每个分区的尾部，然后以先入先出的顺序进行读取。由于一个主题包含多个分区，<font style="color:green;">因此无法在整个主题范围内保证消息的顺序，但可以保证单个分区内消息的顺序。</font></p> <p>分区中的每个记录都被分配了一个<strong>偏移量（Offset）</strong>，偏移量是<strong>一个连续递增的整数值</strong>，它<strong>唯一标识分区中的某个记录</strong>。而消费者只需保存该偏移量即可，当消费者客户端向Broker发起消息请求时需要携带偏移量。</p> <p>例如，消费者向Broker请求主题test的分区0中的偏移量从20开始的所有消息以及主题test的分区1中的偏移量从35开始的所有消息。当消费者读取消息后，偏移量会线性递增。当然，消费者也可以按照任意顺序消费消息，比如读取已经消费过的<strong>历史消息</strong>（将偏移量重置到之前版本）。</p> <p>此外，<strong>消费者还可以指定从某个分区中一次最多返回多少条数据，防止一次返回数据太多而耗尽客户端的内存</strong>。</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/10385897/1661481502309-daf44994-9810-4029-a615-ce4fd2855cff.png" alt="图片.png"></p> <p>对于已经发布的消息，无论这些消息是否被消费，Kafka都将会保留一段时间，具体的<strong>保留策略</strong>有两种：根据<strong>时间</strong>保留（例如7天）和根据<strong>消息大小</strong>保留（例如1GB），可以进行相关参数配置，选择具体策略。</p> <p>当消息数量达到配置的策略上限时，Kafka就会为节省磁盘空间而将旧消息删除。例如，设置消息保留两天，则两天内该消息可以随时被消费，但两天后该消息将被删除。Kafka的性能对数据大小不敏感，因此保留大量数据毫无压力。</p> <p>每个主题也可以配置自己的保留策略，可以根据具体的业务进行设置。例如，用于跟踪用户活动的数据可能需要保留几天，而应用程序的度量指标可能只需要保留几个小时。</p> <h3 id="分区副本"><a href="#分区副本" class="header-anchor">#</a> 分区副本</h3> <p>在Kafka集群中，为了提高数据的可靠性，同一个分区可以复制多个副本分配到不同的Broker，这种方式类似于HDFS中的副本机制。如果其中一个Broker宕机，其他Broker可以接替宕机的Broker，不过生产者和消费者需要重新连接到新的Broker。Kafka分区的复制如图:</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/10385897/1661481609713-a323a2d5-49de-4f54-a05c-de0d5f8fa1ab.png" alt="图片.png"></p> <p><strong>Kafka每个分区的副本都被分为两种类型：领导者副本和跟随者副本。领导者副本只有一个，其余的都是跟随者副本。所有生产者和消费者都向领导者副本发起请求，进行消息的写入与读取，而跟随者副本并不处理客户端的请求，它唯一的任务是从领导者副本复制消息，以保持与领导者副本数据及状态的一致。</strong></p> <p>如果领导者副本发生崩溃，就会从其余的跟随者副本中选出一个作为新的领导者副本。领导者与跟随者在Kafka集群中的分布如图:</p> <p><img src="https://cdn.nlark.com/yuque/0/2022/png/10385897/1661481658440-4f9e2db9-ca0b-4c4d-9747-0e02afeab456.png" alt="图片.png"></p> <p>跟随者为了与领导者保持同步，会周期性地向领导者发起获取数据的请求（Pull），这种请求与消费者读取消息发送的请求是一样的。请求消息里包含跟随者想要获取消息的偏移量，偏移量的值随着每次请求进行递增。领导者从跟随者请求的偏移量可以知道消息复制的进度。</p> <p>Kafka的消息复制是以分区为单位的，既不是完全的同步复制，又不是完全的异步复制，而是基于<strong>ISR</strong>（In-Sync Replica）的动态复制方案。</p> <p><strong>领导者会维护一个需要与其保持同步的副本列表（包括领导者自己），该列表称为ISR</strong>，**且每个分区都会有一个ISR。**如果在一定时间内（可以通过参数replica.lag.time.max.ms进行配置），跟随者没有向领导者请求新的消息（可能由于网络问题），该跟随者将被认为是不同步的，领导者会从ISR中将其移除，从而避免因跟随者的请求速度过慢而拖慢整体速度。而当跟随者重新与领导者保持同步，领导者会将其再次加入ISR中。当领导者失效时，也不会选择ISR中不存在的跟随者作为新的领导者。</p> <p>ISR的列表数据保存在ZooKeeper中，每次ISR改变后，领导者都会将最新的ISR同步到ZooKeeper中。</p> <h3 id="消费者组"><a href="#消费者组" class="header-anchor">#</a> 消费者组</h3> <p>消费者组（Consumer Group）实际上就是一组消费者的集合。每个消费者属于一个特定的消费者组（可为每个消费者指定组名称，消费者通过组名称对自己进行标识，若不指定组名称，则属于默认的组）。</p> <p>传统消息处理有两种模式：<strong>队列模式和发布订阅模式</strong></p> <ul><li><ul><li><strong>队列模式</strong>是指消费者可以从一台服务器读取消息，并且每个消息只被其中一个消费者消费；</li> <li><strong>发布订阅模式</strong>是指消息通过广播方式发送给所有消费者。</li></ul></li></ul> <p>Kafka提供了消费者组模式，同时具备这两种（队列和发布订阅）模式的特点。</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/huoranger/edit/master/docs/01.后端技术/04.中间件/02.Kafka/01.Kafka.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=KafKa" title="标签">#KafKa</a><a href="/tags/?tag=%E4%B8%AD%E9%97%B4%E4%BB%B6" title="标签">#中间件</a><a href="/tags/?tag=%E5%90%8E%E7%AB%AF" title="标签">#后端</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/11/24, 16:16:30</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev"><a href="/pages/99a9d9/" class="prev">上一篇:数据结构与内部编码</a></span> <span class="next"><a href="/pages/420934/">下一篇:IntelleJ Idea</a></span></p></div></div></div> <!----></main></div> <div class="footer">
    Copyright © 2019-2022
  </div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-huidaodingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="icon-zidong"><span class="iconfont"></span> <span class="name">跟随系统</span></li><li class="icon-rijianmoshi"><span class="iconfont"></span> <span class="name">浅色模式</span></li><li class="icon-yejianmoshi"><span class="iconfont"></span> <span class="name">深色模式</span></li><li class="icon-yuedu"><span class="iconfont"></span> <span class="name">阅读模式</span></li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.342c2b09.js" defer></script><script src="/assets/js/2.30520199.js" defer></script><script src="/assets/js/3.b6a398a6.js" defer></script><script src="/assets/js/23.d0073c19.js" defer></script>
  </body>
</html>
